<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BHiveQ Observability Hub - LPD Digital Hive</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - LPD Hive Brand Typography -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/lpd-hive.css') }}">
    
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="navbar navbar-dark fixed-top">
        <div class="container-fluid">
            <div class="navbar-brand d-flex align-items-center">
                <img src="{{ url_for('static', filename='brand/logo.png') }}" alt="LPD Digital Hive" height="32" class="me-3">
                <span class="brand-text">BHiveQ Observability Hub</span>
            </div>
            <div class="d-flex align-items-center">
                <div class="status-indicator me-3">
                    <span class="badge bg-success pulse" id="connection-status">
                        <i class="fas fa-circle"></i> Connected
                    </span>
                </div>
                <div class="me-3">
                    <button class="btn btn-sm btn-outline-orange" id="voice-toggle" title="Toggle Voice Notifications">
                        <i class="fas fa-volume-up" id="voice-icon"></i>
                    </button>
                </div>
                <div class="text-light me-3">
                    <small>Region: <span class="text-orange">sa-east-1</span></small>
                </div>
                <div class="text-light">
                    <small>Last Update: <span id="last-update" class="text-orange">--:--:--</span></small>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content - 2 Column Layout -->
    <div class="main-content">
        <div class="container-fluid h-100">
            <div class="row h-100">
                <!-- Left Column (40%) - DLQs and Agents -->
                <div class="col-lg-5 h-100 d-flex flex-column">
                    <!-- DLQ Status Panel -->
                    <div class="panel mb-3" style="flex: 0 0 45%;">
                        <div class="panel-header">
                            <h5><i class="fas fa-exclamation-triangle text-orange"></i> Dead Letter Queues</h5>
                            <div class="d-flex align-items-center">
                                <span class="badge bg-danger me-2" id="critical-count">0</span>
                                <span class="badge bg-warning me-2" id="warning-count">0</span>
                                <span class="badge bg-success me-2" id="healthy-count">0</span>
                                <button class="btn btn-sm btn-outline-orange" onclick="refreshDLQs()" title="Refresh">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="panel-body" id="dlq-panel">
                            <div class="dlq-list">
                                <!-- DLQ items with click-to-investigate -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Active Agents Panel with Details -->
                    <div class="panel" style="flex: 1;">
                        <div class="panel-header">
                            <h5><i class="fas fa-robot text-orange"></i> Active Agents</h5>
                            <div class="d-flex align-items-center">
                                <span class="badge bg-orange me-2" id="agent-count">0</span>
                                <button class="btn btn-sm btn-outline-orange" onclick="toggleAgentDetails()" title="Toggle Details">
                                    <i class="fas fa-expand-alt" id="agent-expand-icon"></i>
                                </button>
                            </div>
                        </div>
                        <div class="panel-body" id="agents-panel">
                            <!-- Agent cards with expandable activity logs -->
                            <div class="agent-cards">
                                <!-- Dynamic agent cards -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column (60%) - Activity Feed, Investigations, PRs -->
                <div class="col-lg-7 h-100 d-flex flex-column">
                    <!-- Activity Feed Panel -->
                    <div class="panel mb-3" style="flex: 0 0 55%;">
                        <div class="panel-header">
                            <h5><i class="fas fa-stream text-orange"></i> Activity Feed</h5>
                            <div class="btn-group btn-group-sm" role="group">
                                <button class="btn btn-outline-orange active" data-filter="all">All</button>
                                <button class="btn btn-outline-orange" data-filter="agents">Agents</button>
                                <button class="btn btn-outline-orange" data-filter="investigations">Investigations</button>
                                <button class="btn btn-outline-orange" data-filter="prs">PRs</button>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="activity-feed" id="activity-feed">
                                <!-- Real-time activity entries -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bottom Row - Investigations and PRs -->
                    <div class="row" style="flex: 1;">
                        <!-- Active Investigations -->
                        <div class="col-md-6 d-flex">
                            <div class="panel w-100">
                                <div class="panel-header">
                                    <h5><i class="fas fa-search text-orange"></i> Investigations</h5>
                                    <div class="d-flex align-items-center">
                                        <span class="badge bg-info me-2" id="investigation-count">0</span>
                                        <button class="btn btn-sm btn-outline-orange" onclick="forceReinvestigation()" title="Force New">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="panel-body" id="investigations-panel">
                                    <div class="investigation-list">
                                        <!-- Investigation cards with progress bars -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pull Requests (Compact) -->
                        <div class="col-md-6 d-flex">
                            <div class="panel w-100">
                                <div class="panel-header">
                                    <h5><i class="fab fa-github text-orange"></i> Pull Requests</h5>
                                    <span class="badge bg-warning" id="pr-count">0</span>
                                </div>
                                <div class="panel-body" id="pr-panel">
                                    <div class="pr-list compact">
                                        <!-- Compact PR list (max 3 visible) -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Stats Bar -->
        <div class="stats-bar">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-auto">
                        <div class="stat-item">
                            <span class="stat-label">Messages</span>
                            <span class="stat-value text-orange" id="messages-processed">0</span>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="stat-item">
                            <span class="stat-label">Investigations</span>
                            <span class="stat-value text-info" id="investigations-today">0</span>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="stat-item">
                            <span class="stat-label">PRs</span>
                            <span class="stat-value text-warning" id="prs-created">0</span>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="stat-item">
                            <span class="stat-label">Resolved</span>
                            <span class="stat-value text-success" id="issues-resolved">0</span>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="stat-item">
                            <span class="stat-label">Active Agents</span>
                            <span class="stat-value" id="active-agents-stat">0</span>
                        </div>
                    </div>
                    <div class="col-auto ms-auto">
                        <div class="hexagon-pattern">
                            <img src="{{ url_for('static', filename='brand/symbol.png') }}" alt="LPD Hive" height="40">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="margin-top: 80px; z-index: 9999;">
        <div id="alert-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-bell text-orange me-2"></i>
                <strong class="me-auto">System Alert</strong>
                <small class="text-muted">just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <!-- Alert message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="/static/js/dashboard.js"></script>
</body>
</html>