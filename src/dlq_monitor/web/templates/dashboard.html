<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BHiveQ Observability Hub - LPD Digital Hive</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/lpd-hive.css') }}">
    
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="navbar navbar-dark fixed-top">
        <div class="container-fluid">
            <div class="navbar-brand d-flex align-items-center">
                <img src="{{ url_for('static', filename='brand/logo.png') }}" alt="LPD Digital Hive" height="32" class="me-3">
                <span class="brand-text">BHiveQ Observability Hub</span>
            </div>
            <div class="d-flex align-items-center">
                <div class="status-indicator me-3">
                    <span class="badge bg-success pulse" id="connection-status">
                        <i class="fas fa-circle"></i> Connected
                    </span>
                </div>
                <div class="text-light me-3">
                    <small>Region: <span class="text-orange">sa-east-1</span></small>
                </div>
                <div class="text-light">
                    <small>Last Update: <span id="last-update" class="text-orange">--:--:--</span></small>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="container-fluid h-100">
            <div class="row h-100">
                <!-- Left Panel: Agent Status & Activities -->
                <div class="col-lg-4 h-100">
                    <div class="panel h-100">
                        <div class="panel-header">
                            <h5><i class="fas fa-robot text-orange"></i> Active Agents</h5>
                            <span class="badge bg-orange" id="agent-count">0</span>
                        </div>
                        <div class="panel-body" id="agents-panel">
                            <!-- Agent Cards -->
                            <div class="agent-card" id="investigator-agent">
                                <div class="agent-header">
                                    <div class="agent-icon">
                                        <i class="fas fa-search"></i>
                                    </div>
                                    <div class="agent-info">
                                        <h6>Investigation Agent</h6>
                                        <span class="agent-status" data-status="idle">
                                            <i class="fas fa-circle"></i> Idle
                                        </span>
                                    </div>
                                </div>
                                <div class="agent-details">
                                    <small class="text-muted">Last Activity: <span class="last-activity">Never</span></small>
                                    <div class="agent-task mt-2 d-none">
                                        <small class="text-orange">Current Task:</small>
                                        <div class="task-description"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="agent-card" id="analyzer-agent">
                                <div class="agent-header">
                                    <div class="agent-icon">
                                        <i class="fas fa-microscope"></i>
                                    </div>
                                    <div class="agent-info">
                                        <h6>DLQ Analyzer</h6>
                                        <span class="agent-status" data-status="idle">
                                            <i class="fas fa-circle"></i> Idle
                                        </span>
                                    </div>
                                </div>
                                <div class="agent-details">
                                    <small class="text-muted">Last Activity: <span class="last-activity">Never</span></small>
                                    <div class="agent-task mt-2 d-none">
                                        <small class="text-orange">Current Task:</small>
                                        <div class="task-description"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="agent-card" id="debugger-agent">
                                <div class="agent-header">
                                    <div class="agent-icon">
                                        <i class="fas fa-bug"></i>
                                    </div>
                                    <div class="agent-info">
                                        <h6>Code Debugger</h6>
                                        <span class="agent-status" data-status="idle">
                                            <i class="fas fa-circle"></i> Idle
                                        </span>
                                    </div>
                                </div>
                                <div class="agent-details">
                                    <small class="text-muted">Last Activity: <span class="last-activity">Never</span></small>
                                    <div class="agent-task mt-2 d-none">
                                        <small class="text-orange">Current Task:</small>
                                        <div class="task-description"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="agent-card" id="reviewer-agent">
                                <div class="agent-header">
                                    <div class="agent-icon">
                                        <i class="fas fa-check-double"></i>
                                    </div>
                                    <div class="agent-info">
                                        <h6>Code Reviewer</h6>
                                        <span class="agent-status" data-status="idle">
                                            <i class="fas fa-circle"></i> Idle
                                        </span>
                                    </div>
                                </div>
                                <div class="agent-details">
                                    <small class="text-muted">Last Activity: <span class="last-activity">Never</span></small>
                                    <div class="agent-task mt-2 d-none">
                                        <small class="text-orange">Current Task:</small>
                                        <div class="task-description"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Center Panel: DLQ Monitoring & Analysis -->
                <div class="col-lg-4 h-100">
                    <!-- DLQ Status Overview -->
                    <div class="panel mb-3" style="height: 32%;">
                        <div class="panel-header">
                            <h5><i class="fas fa-exclamation-triangle text-orange"></i> DLQ Status</h5>
                            <div class="d-flex align-items-center">
                                <span class="badge bg-danger me-2" id="critical-count">0</span>
                                <span class="badge bg-warning me-2" id="warning-count">0</span>
                                <span class="badge bg-success" id="healthy-count">0</span>
                            </div>
                        </div>
                        <div class="panel-body" id="dlq-status-panel">
                            <div class="dlq-list">
                                <!-- DLQ items will be dynamically added here -->
                            </div>
                        </div>
                    </div>

                    <!-- Active Investigations -->
                    <div class="panel mb-3" style="height: 32%;">
                        <div class="panel-header">
                            <h5><i class="fas fa-flask text-orange"></i> Active Investigations</h5>
                            <div class="d-flex align-items-center">
                                <span class="badge bg-orange" id="investigation-count">0</span>
                                <button class="btn btn-sm btn-outline-orange ms-2" onclick="forceReinvestigation()" title="Force Reinvestigation">
                                    <i class="fas fa-redo"></i>
                                </button>
                            </div>
                        </div>
                        <div class="panel-body" id="investigations-panel">
                            <div class="investigation-list">
                                <!-- Investigation items will be dynamically added here -->
                            </div>
                        </div>
                    </div>

                    <!-- Real-time Agent Logs -->
                    <div class="panel" style="height: 32%;">
                        <div class="panel-header">
                            <h5><i class="fas fa-stream text-orange"></i> Live Agent Activity</h5>
                            <span class="badge bg-success pulse">STREAMING</span>
                        </div>
                        <div class="panel-body" id="log-stream-panel">
                            <div class="log-stream">
                                <!-- Real-time logs will stream here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Pull Requests & Actions -->
                <div class="col-lg-4 h-100">
                    <!-- Pull Requests -->
                    <div class="panel mb-3" style="height: 48%;">
                        <div class="panel-header">
                            <h5><i class="fab fa-github text-orange"></i> Pull Requests</h5>
                            <span class="badge bg-orange" id="pr-count">0</span>
                        </div>
                        <div class="panel-body" id="pr-panel">
                            <div class="pr-list">
                                <!-- PR items will be dynamically added here -->
                            </div>
                        </div>
                    </div>

                    <!-- Recent Actions & Timeline -->
                    <div class="panel" style="height: 48%;">
                        <div class="panel-header">
                            <h5><i class="fas fa-history text-orange"></i> Recent Actions</h5>
                        </div>
                        <div class="panel-body" id="actions-panel">
                            <div class="timeline">
                                <!-- Timeline items will be dynamically added here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Stats Bar -->
            <div class="stats-bar">
                <div class="container-fluid">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <div class="stat-item">
                                <span class="stat-label">Messages Processed</span>
                                <span class="stat-value" id="messages-processed">0</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="stat-item">
                                <span class="stat-label">Investigations Today</span>
                                <span class="stat-value" id="investigations-today">0</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="stat-item">
                                <span class="stat-label">PRs Created</span>
                                <span class="stat-value" id="prs-created">0</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="stat-item">
                                <span class="stat-label">Issues Resolved</span>
                                <span class="stat-value" id="issues-resolved">0</span>
                            </div>
                        </div>
                        <div class="col-auto ms-auto">
                            <div class="hexagon-pattern">
                                <img src="{{ url_for('static', filename='brand/symbol.png') }}" alt="LPD Hive" height="40">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="margin-top: 80px;">
        <div id="alert-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-bell text-orange me-2"></i>
                <strong class="me-auto">System Alert</strong>
                <small class="text-muted">just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <!-- Alert message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="/static/js/dashboard.js"></script>
</body>
</html>