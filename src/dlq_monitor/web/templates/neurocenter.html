<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent NeuroCenter - Operational Intelligence</title>
    
    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    
    <!-- diff2html for code diffs -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html@3.4.35/bundles/css/diff2html.min.css">
    
    <!-- Custom NeuroCenter CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/neurocenter.css') }}?v={{ range(1000, 9999) | random }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/queue-monitor.css') }}?v={{ range(1000, 9999) | random }}">
    
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- Chart.js for metrics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SortableJS for drag-and-drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
</head>
<body class="neurocenter-body">
    
    <!-- Top Bar - Reduced Height -->
    <div class="neurocenter-topbar">
        <div class="topbar-left">
            <img src="{{ url_for('static', filename='brand/Símbolo LPDH.png') }}" alt="LPD Hive Symbol" class="brand-symbol">
            <img src="{{ url_for('static', filename='brand/Logo LPDH Laranja.png') }}" alt="LPD Hive Logo" class="brand-logo">
            <span class="brand-text">Agent NeuroCenter</span>
        </div>
        
        <div class="topbar-center">
            <div class="status-indicator">
                <span class="pulse-dot"></span>
                <span class="status-text">OPERATIONAL</span>
            </div>
        </div>
        
        <div class="topbar-right">
            <button class="btn-icon" id="voice-toggle" title="Voice Notifications">
                <i data-lucide="volume-2"></i>
            </button>
            <button class="btn-icon" id="alerts-toggle" title="System Alerts">
                <i data-lucide="bell"></i>
                <span class="alert-badge">3</span>
            </button>
            <button class="btn-icon" id="settings-toggle" title="Settings">
                <i data-lucide="settings"></i>
            </button>
        </div>
    </div>
    
    <!-- Quick Access Toolbar -->
    <div class="quick-access-toolbar">
        <button class="quick-btn" onclick="investigateAll()" title="Investigate All DLQs">
            <i data-lucide="search-check"></i>
            <span>Investigate All</span>
        </button>
        <button class="quick-btn" onclick="purgeQueues()" title="Purge Selected Queues">
            <i data-lucide="trash-2"></i>
            <span>Purge Queues</span>
        </button>
        <button class="quick-btn" onclick="exportReport()" title="Export Report">
            <i data-lucide="download"></i>
            <span>Export Report</span>
        </button>
        <button class="quick-btn" onclick="toggleAutoMode()" title="Toggle Auto Mode">
            <i data-lucide="toggle-left"></i>
            <span>Auto Mode</span>
        </button>
        <button class="quick-btn" onclick="viewLogs()" title="View System Logs">
            <i data-lucide="file-text"></i>
            <span>View Logs</span>
        </button>
        <div class="toolbar-separator"></div>
        <button class="quick-btn" onclick="toggleCompactView()" title="Toggle Compact View">
            <i data-lucide="minimize-2"></i>
            <span>Compact</span>
        </button>
    </div>
    
    <!-- Tab Navigation -->
    <div class="tab-navigation">
        <button class="tab-btn active" data-tab="dashboard">
            <i data-lucide="layout-dashboard"></i> Dashboard
        </button>
        <button class="tab-btn" data-tab="glass-room">
            <i data-lucide="brain"></i> Glass Room
        </button>
        <button class="tab-btn" data-tab="observe">
            <i data-lucide="eye"></i> Observe Mode
        </button>
        <button class="tab-btn" data-tab="terminal">
            <i data-lucide="terminal"></i> AI Terminal
        </button>
    </div>
    
    <!-- Main Grid Container - Modern 4-Column Layout -->
    <div class="tab-content active" id="dashboard-tab">
    <div class="neurocenter-container modern-grid" id="grid-container">
        
        <!-- PRIMARY ROW: Most Important Panels -->
        
        <!-- Dead Letter Queues - Enhanced Visibility (2 columns) -->
        <div class="module-card modern-card primary-panel" data-module="dlqs">
            <div class="module-header gradient-header">
                <div class="module-title">
                    <i data-lucide="alert-triangle" class="module-icon pulse-animation"></i>
                    <span>Dead Letter Queues</span>
                    <span class="module-subtitle">Real-time Queue Health</span>
                </div>
                <div class="module-badges">
                    <span class="badge-critical animated" id="dlq-critical">0</span>
                    <span class="badge-warning animated" id="dlq-warning">0</span>
                    <span class="badge-ok animated" id="dlq-ok">0</span>
                </div>
            </div>
            <div class="module-body scrollable">
                <div class="dlq-list enhanced" id="dlq-list">
                    <!-- Dynamic DLQ items with enhanced cards -->
                </div>
            </div>
        </div>
        
        <!-- Live Agent Overview - Enhanced Visibility (2 columns) -->
        <div class="module-card modern-card primary-panel" data-module="agents">
            <div class="module-header gradient-header">
                <div class="module-title">
                    <i data-lucide="users" class="module-icon pulse-animation"></i>
                    <span>Live Agent Overview</span>
                    <span class="module-subtitle">Active Investigations</span>
                </div>
                <div class="module-actions">
                    <button class="btn-module-action glass-effect" onclick="refreshAgents()">
                        <i data-lucide="refresh-cw"></i>
                    </button>
                    <button class="btn-module-action glass-effect" onclick="deployAgent()">
                        <i data-lucide="plus"></i>
                    </button>
                </div>
            </div>
            <div class="module-body scrollable">
                <div class="agents-grid">
                    <!-- Agent cards instead of table -->
                    <div id="agents-container" class="agent-cards-container">
                        <!-- Dynamic agent cards -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SECONDARY ROW: Monitoring -->
        
        <!-- AWS SQS Queue Monitor - Full Width Collapsible -->
        <div class="module-card modern-card secondary-panel collapsible" data-module="dlq-monitor">
            <div class="module-header compact-header">
                <div class="module-title">
                    <button class="collapse-toggle" onclick="togglePanel('dlq-monitor')">
                        <i data-lucide="chevron-down" class="collapse-icon"></i>
                    </button>
                    <i data-lucide="database" class="module-icon"></i>
                    <span>AWS SQS Queue Monitor</span>
                    <span class="account-info subtle">Account: 432817839790 | Region: sa-east-1</span>
                </div>
                <div class="module-actions">
                    <button class="btn-action-compact" onclick="location.reload()">
                        <i data-lucide="refresh-cw"></i>
                    </button>
                    <button class="btn-action-compact primary" onclick="investigateSelected()">
                        <i data-lucide="search"></i> Investigate
                    </button>
                </div>
            </div>
            <div class="module-body collapsible-body">
                <div class="queue-controls compact">
                    <input type="text" id="queue-search" placeholder="Search queues..." class="queue-search modern-input">
                    <select id="queue-filter" class="queue-filter modern-select">
                        <option value="all">All Queues</option>
                        <option value="dlq">DLQ Only</option>
                        <option value="with-messages">With Messages</option>
                        <option value="monitored">Monitored</option>
                    </select>
                </div>
                <div class="queue-cards-container" id="queue-cards">
                    <!-- Modern card-based queue display -->
                </div>
            </div>
        </div>
        
        <!-- TERTIARY ROW: Insights -->
        
        <!-- Live Metrics - Visual KPI Cards (1 column) -->
        <div class="module-card modern-card tertiary-panel" data-module="metrics">
            <div class="module-header minimal-header">
                <div class="module-title">
                    <i data-lucide="trending-up" class="module-icon"></i>
                    <span>Performance Metrics</span>
                </div>
            </div>
            <div class="module-body no-padding">
                <div class="metrics-stack">
                    <div class="metric-card-modern hoverable">
                        <div class="metric-content">
                            <div class="metric-value-large" id="metric-active-agents">0</div>
                            <div class="metric-label-modern">Active Agents</div>
                            <div class="metric-sparkline" id="sparkline-agents"></div>
                        </div>
                        <div class="metric-icon-modern active-pulse">
                            <i data-lucide="cpu"></i>
                        </div>
                    </div>
                    
                    <div class="metric-card-modern hoverable">
                        <div class="metric-content">
                            <div class="metric-value-large" id="metric-avg-time">0m</div>
                            <div class="metric-label-modern">Avg Time</div>
                            <div class="metric-sparkline" id="sparkline-time"></div>
                        </div>
                        <div class="metric-icon-modern">
                            <i data-lucide="clock"></i>
                        </div>
                    </div>
                    
                    <div class="metric-card-modern hoverable">
                        <div class="metric-content">
                            <div class="metric-value-large" id="metric-prs">0</div>
                            <div class="metric-label-modern">PRs Today</div>
                            <div class="metric-sparkline" id="sparkline-prs"></div>
                        </div>
                        <div class="metric-icon-modern success-pulse">
                            <i data-lucide="git-pull-request"></i>
                        </div>
                    </div>
                    
                    <div class="metric-card-modern hoverable">
                        <div class="metric-content">
                            <div class="metric-value-large" id="metric-success">0%</div>
                            <div class="metric-label-modern">Success Rate</div>
                            <div class="metric-sparkline" id="sparkline-success"></div>
                        </div>
                        <div class="metric-icon-modern">
                            <i data-lucide="target"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Investigation Timeline - Positioned below DLQ panel -->
        <div class="module-card modern-card" data-module="timeline">
            <div class="module-header minimal-header">
                <div class="module-title">
                    <i data-lucide="activity" class="module-icon"></i>
                    <span>Investigation Timeline</span>
                </div>
                <div class="module-filters">
                    <select class="filter-select modern-select-compact" id="timeline-filter">
                        <option value="all">All</option>
                        <option value="active">Active</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
            </div>
            <div class="module-body scrollable">
                <div class="timeline-container event-style" id="investigation-timeline">
                    <!-- Event-style timeline cards -->
                </div>
            </div>
        </div>
        
        <!-- Recent Actions - Compact List (1 column) -->
        <div class="module-card modern-card tertiary-panel" data-module="actions">
            <div class="module-header minimal-header">
                <div class="module-title">
                    <i data-lucide="zap" class="module-icon"></i>
                    <span>Recent Actions</span>
                </div>
            </div>
            <div class="module-body scrollable">
                <div class="actions-list compact-list" id="recent-actions">
                    <!-- Compact action items -->
                </div>
            </div>
        </div>
        
        
    </div>
    </div>
    
    <!-- Glass Room Tab -->
    <div class="tab-content" id="glass-room-tab">
        <div class="glass-room-container">
            <!-- Agent Activity Feed -->
            <div class="glass-room-panel activity-feed">
                <div class="panel-header">
                    <h3><i data-lucide="activity"></i> Agent Activity Feed</h3>
                    <div class="feed-controls">
                        <button class="btn-filter" data-filter="all">All</button>
                        <button class="btn-filter" data-filter="critical">Critical</button>
                        <button class="btn-filter" data-filter="insights">Insights</button>
                    </div>
                </div>
                <div class="feed-container" id="agent-activity-feed">
                    <!-- Natural language agent updates will appear here -->
                </div>
            </div>
            
            <!-- Context Storyline -->
            <div class="glass-room-panel context-storyline">
                <div class="panel-header">
                    <h3><i data-lucide="book-open"></i> Context Storyline</h3>
                </div>
                <div class="storyline-container" id="context-storyline">
                    <!-- Case narratives will appear here -->
                </div>
            </div>
            
            <!-- Agent Constellation -->
            <div class="glass-room-panel agent-constellation">
                <div class="panel-header">
                    <h3><i data-lucide="network"></i> Agent Constellation</h3>
                </div>
                <div class="constellation-container" id="agent-constellation">
                    <!-- Visual agent network will appear here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Observe Mode Tab -->
    <div class="tab-content" id="observe-tab">
        <div class="observe-container">
            <div class="cinematic-view" id="cinematic-view">
                <!-- Cinematic agent visualization will appear here -->
            </div>
            <div class="observe-controls">
                <button class="btn-play" id="play-pause"><i data-lucide="play"></i></button>
                <button class="btn-speed" data-speed="1x">1x</button>
                <button class="btn-speed" data-speed="2x">2x</button>
                <button class="btn-speed" data-speed="0.5x">0.5x</button>
            </div>
        </div>
    </div>
    
    <!-- AI Terminal Tab -->
    <div class="tab-content" id="terminal-tab">
        <div class="terminal-container">
            <div class="terminal-output" id="terminal-output">
                <div class="terminal-welcome">
                    Welcome to NeuroCenter AI Terminal v1.0
                    Type 'help' for available commands or ask questions in natural language.
                    ────────────────────────────────────────────────────────────
                </div>
            </div>
            <div class="terminal-input-container">
                <span class="terminal-prompt">neurocenter@ai &gt;</span>
                <input type="text" class="terminal-input" id="terminal-input" placeholder="Ask about agents, incidents, or type commands...">
            </div>
        </div>
    </div>
    
    <!-- Investigation Details Side Panel -->
    <div class="side-panel" id="investigation-panel">
        <div class="panel-header">
            <h3>Investigation Details</h3>
            <button class="btn-close" onclick="closePanel()">
                <i data-lucide="x"></i>
            </button>
        </div>
        <div class="panel-body" id="panel-content">
            <!-- Dynamic investigation details -->
        </div>
    </div>
    
    <!-- Alert Toast Container -->
    <div class="toast-container" id="toast-container">
        <!-- Dynamic toast alerts -->
    </div>
    
    <!-- Add Mapping Modal -->
    <div class="modal" id="mapping-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Agent-DLQ Mapping</h3>
                <button class="btn-close" onclick="closeMappingModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Agent</label>
                    <select id="mapping-agent" class="form-control">
                        <option value="investigator">Investigation Agent</option>
                        <option value="analyzer">DLQ Analyzer</option>
                        <option value="debugger">Code Debugger</option>
                        <option value="reviewer">Code Reviewer</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>DLQ Pattern</label>
                    <input type="text" id="mapping-pattern" class="form-control" 
                           placeholder="e.g., fm-*-dlq-prod or exact name">
                </div>
                
                <div class="form-group">
                    <label>Trigger Type</label>
                    <select id="mapping-trigger-type" class="form-control">
                        <option value="message_count">Message Count</option>
                        <option value="regex">Regex Match</option>
                        <option value="always">Always</option>
                        <option value="manual">Manual Only</option>
                    </select>
                </div>
                
                <div class="form-group" id="trigger-threshold-group">
                    <label>Message Threshold</label>
                    <input type="number" id="mapping-threshold" class="form-control" 
                           value="50" min="1">
                </div>
                
                <div class="form-group">
                    <label>Environment</label>
                    <select id="mapping-environment" class="form-control">
                        <option value="all">All</option>
                        <option value="prod">Production</option>
                        <option value="staging">Staging</option>
                        <option value="dev">Development</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMappingModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveMappingModal()">Save Mapping</button>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Prism.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    
    <!-- diff2html -->
    <script src="https://cdn.jsdelivr.net/npm/diff2html@3.4.35/bundles/js/diff2html-ui.min.js"></script>
    
    <!-- Custom NeuroCenter JS -->
    <script src="{{ url_for('static', filename='js/neurocenter.js') }}?v={{ range(1000, 9999) | random }}"></script>
    
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>