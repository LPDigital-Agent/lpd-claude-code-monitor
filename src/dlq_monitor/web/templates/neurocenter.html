<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ§  BHiveQ NeuroCenter - Operational Intelligence</title>
    
    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    
    <!-- diff2html for code diffs -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html@3.4.35/bundles/css/diff2html.min.css">
    
    <!-- Custom NeuroCenter CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/neurocenter.css') }}">
    
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- Chart.js for metrics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SortableJS for drag-and-drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
</head>
<body class="neurocenter-body">
    
    <!-- Top Bar -->
    <div class="neurocenter-topbar">
        <div class="topbar-left">
            <div class="brand">
                <div class="hexagon-logo">
                    <svg width="40" height="40" viewBox="0 0 40 40">
                        <polygon points="20,2 35,10 35,30 20,38 5,30 5,10" 
                                fill="none" stroke="#FA4616" stroke-width="2"/>
                        <circle cx="20" cy="20" r="8" fill="#FA4616" opacity="0.3"/>
                        <circle cx="20" cy="20" r="3" fill="#FA4616"/>
                    </svg>
                </div>
                <span class="brand-text">BHiveQ NeuroCenter</span>
            </div>
        </div>
        
        <div class="topbar-center">
            <div class="status-indicator">
                <span class="pulse-dot"></span>
                <span class="status-text">OPERATIONAL</span>
            </div>
        </div>
        
        <div class="topbar-right">
            <button class="btn-icon" id="voice-toggle" title="Voice Notifications">
                <i data-lucide="volume-2"></i>
            </button>
            <button class="btn-icon" id="alerts-toggle" title="System Alerts">
                <i data-lucide="bell"></i>
                <span class="alert-badge">3</span>
            </button>
            <button class="btn-icon" id="settings-toggle" title="Settings">
                <i data-lucide="settings"></i>
            </button>
        </div>
    </div>
    
    <!-- Main Grid Container -->
    <div class="neurocenter-container" id="grid-container">
        
        <!-- Module 1: Live Agent Overview -->
        <div class="module-card" data-module="agents">
            <div class="module-header">
                <div class="module-title">
                    <i data-lucide="users" class="module-icon"></i>
                    <span>Live Agent Overview</span>
                </div>
                <div class="module-actions">
                    <button class="btn-module-action" onclick="refreshAgents()">
                        <i data-lucide="refresh-cw"></i>
                    </button>
                </div>
            </div>
            <div class="module-body">
                <table class="agents-table">
                    <thead>
                        <tr>
                            <th>Agent</th>
                            <th>Status</th>
                            <th>Started</th>
                            <th>Elapsed</th>
                            <th>Target</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="agents-tbody">
                        <!-- Dynamic agent rows -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Module 2: Investigation Timeline -->
        <div class="module-card" data-module="timeline">
            <div class="module-header">
                <div class="module-title">
                    <i data-lucide="activity" class="module-icon"></i>
                    <span>Investigation Timeline</span>
                </div>
                <div class="module-filters">
                    <select class="filter-select" id="timeline-filter">
                        <option value="all">All Investigations</option>
                        <option value="active">Active</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
            </div>
            <div class="module-body">
                <div class="timeline-container" id="investigation-timeline">
                    <!-- Dynamic timeline entries -->
                </div>
            </div>
        </div>
        
        <!-- Module 3: Live Metrics -->
        <div class="module-card" data-module="metrics">
            <div class="module-header">
                <div class="module-title">
                    <i data-lucide="trending-up" class="module-icon"></i>
                    <span>Live Metrics</span>
                </div>
            </div>
            <div class="module-body">
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon active">
                            <i data-lucide="cpu"></i>
                        </div>
                        <div class="metric-info">
                            <div class="metric-value" id="metric-active-agents">0</div>
                            <div class="metric-label">Active Agents</div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">
                            <i data-lucide="clock"></i>
                        </div>
                        <div class="metric-info">
                            <div class="metric-value" id="metric-avg-time">0m</div>
                            <div class="metric-label">Avg Investigation Time</div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon success">
                            <i data-lucide="git-pull-request"></i>
                        </div>
                        <div class="metric-info">
                            <div class="metric-value" id="metric-prs">0</div>
                            <div class="metric-label">PRs (24h)</div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">
                            <i data-lucide="target"></i>
                        </div>
                        <div class="metric-info">
                            <div class="metric-value" id="metric-success">0%</div>
                            <div class="metric-label">Success Rate</div>
                        </div>
                    </div>
                </div>
                
                <div class="critical-queue-alert" id="critical-queue" style="display: none;">
                    <i data-lucide="alert-triangle"></i>
                    <span>Critical Queue: <strong id="critical-queue-name">-</strong></span>
                    <button class="btn-investigate" onclick="investigateCritical()">Investigate</button>
                </div>
            </div>
        </div>
        
        <!-- Module 4: Agent-DLQ Assignment Matrix -->
        <div class="module-card" data-module="matrix">
            <div class="module-header">
                <div class="module-title">
                    <i data-lucide="grid" class="module-icon"></i>
                    <span>Agent-DLQ Assignment Matrix</span>
                </div>
                <div class="module-actions">
                    <button class="btn-module-action btn-primary" onclick="addMapping()">
                        <i data-lucide="plus"></i> Add Mapping
                    </button>
                </div>
            </div>
            <div class="module-body">
                <table class="matrix-table">
                    <thead>
                        <tr>
                            <th>Agent</th>
                            <th>DLQ Pattern</th>
                            <th>Status</th>
                            <th>Trigger Rule</th>
                            <th>Environment</th>
                            <th>Last Triggered</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="matrix-tbody">
                        <!-- Dynamic mapping rows -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Module 5: DLQ Monitor -->
        <div class="module-card" data-module="dlqs">
            <div class="module-header">
                <div class="module-title">
                    <i data-lucide="alert-circle" class="module-icon"></i>
                    <span>Dead Letter Queues</span>
                </div>
                <div class="module-badges">
                    <span class="badge-critical" id="dlq-critical">0</span>
                    <span class="badge-warning" id="dlq-warning">0</span>
                    <span class="badge-ok" id="dlq-ok">0</span>
                </div>
            </div>
            <div class="module-body">
                <div class="dlq-list" id="dlq-list">
                    <!-- Dynamic DLQ items -->
                </div>
            </div>
        </div>
        
        <!-- Module 6: Recent Actions -->
        <div class="module-card" data-module="actions">
            <div class="module-header">
                <div class="module-title">
                    <i data-lucide="zap" class="module-icon"></i>
                    <span>Recent Actions</span>
                </div>
            </div>
            <div class="module-body">
                <div class="actions-list" id="recent-actions">
                    <!-- Dynamic action items -->
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Investigation Details Side Panel -->
    <div class="side-panel" id="investigation-panel">
        <div class="panel-header">
            <h3>Investigation Details</h3>
            <button class="btn-close" onclick="closePanel()">
                <i data-lucide="x"></i>
            </button>
        </div>
        <div class="panel-body" id="panel-content">
            <!-- Dynamic investigation details -->
        </div>
    </div>
    
    <!-- Alert Toast Container -->
    <div class="toast-container" id="toast-container">
        <!-- Dynamic toast alerts -->
    </div>
    
    <!-- Add Mapping Modal -->
    <div class="modal" id="mapping-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Agent-DLQ Mapping</h3>
                <button class="btn-close" onclick="closeMappingModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Agent</label>
                    <select id="mapping-agent" class="form-control">
                        <option value="investigator">Investigation Agent</option>
                        <option value="analyzer">DLQ Analyzer</option>
                        <option value="debugger">Code Debugger</option>
                        <option value="reviewer">Code Reviewer</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>DLQ Pattern</label>
                    <input type="text" id="mapping-pattern" class="form-control" 
                           placeholder="e.g., fm-*-dlq-prod or exact name">
                </div>
                
                <div class="form-group">
                    <label>Trigger Type</label>
                    <select id="mapping-trigger-type" class="form-control">
                        <option value="message_count">Message Count</option>
                        <option value="regex">Regex Match</option>
                        <option value="always">Always</option>
                        <option value="manual">Manual Only</option>
                    </select>
                </div>
                
                <div class="form-group" id="trigger-threshold-group">
                    <label>Message Threshold</label>
                    <input type="number" id="mapping-threshold" class="form-control" 
                           value="50" min="1">
                </div>
                
                <div class="form-group">
                    <label>Environment</label>
                    <select id="mapping-environment" class="form-control">
                        <option value="all">All</option>
                        <option value="prod">Production</option>
                        <option value="staging">Staging</option>
                        <option value="dev">Development</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMappingModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveMappingModal()">Save Mapping</button>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Prism.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    
    <!-- diff2html -->
    <script src="https://cdn.jsdelivr.net/npm/diff2html@3.4.35/bundles/js/diff2html-ui.min.js"></script>
    
    <!-- Custom NeuroCenter JS -->
    <script src="{{ url_for('static', filename='js/neurocenter.js') }}"></script>
    
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>